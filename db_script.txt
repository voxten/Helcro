CREATE TABLE User (
    UserId INT PRIMARY KEY AUTO_INCREMENT,
    UserName VARCHAR(255) NOT NULL UNIQUE,
    Email VARCHAR(255) NOT NULL UNIQUE,
    Password VARCHAR(255) NOT NULL,
    Height FLOAT,
    Weight FLOAT,
    Gender ENUM('M', 'K', 'Inne'),
    reset_token TEXT,
    reset_token_expires DATETIME,
    deletion_token TEXT,
    deletion_token_expires DATETIME
);

CREATE TABLE Goal (
    UserId INT PRIMARY KEY,
    DailyCalories INT NOT NULL,
    DailyProteins FLOAT NOT NULL,
    DailyFats FLOAT NOT NULL,
    DailyCarbs FLOAT NOT NULL,
    FOREIGN KEY (UserId) REFERENCES User(UserId) ON DELETE CASCADE
);

CREATE TABLE IntakeLog (
    IntakeLogId INT PRIMARY KEY AUTO_INCREMENT,
    UserId INT NOT NULL,
    LogDate DATE NOT NULL,
    FOREIGN KEY (UserId) REFERENCES User(UserId) ON DELETE CASCADE
);

CREATE TABLE Meal (
    MealId INT PRIMARY KEY AUTO_INCREMENT,
    MealType VARCHAR(255) NOT NULL
);

INSERT INTO Meal (MealType) VALUES
('Breakfast'),
('Second Breakfast'),
('Lunch'),
('Afternoon Snack'),
('Dinner'),
('Other');

CREATE TABLE Product (
    ProductId INT AUTO_INCREMENT PRIMARY KEY,
    product_name VARCHAR(255) NOT NULL,
    proteins DECIMAL(10,2),
    fats DECIMAL(10,2),
    carbohydrates DECIMAL(10,2),
    sugars DECIMAL(10,2),
    fibers DECIMAL(10,2),
    salt DECIMAL(10,2),
    calories DECIMAL(10,2),
    image VARCHAR(255),
    date TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE IntakeLog_has_Product (
    IntakeLogId INT NOT NULL,
    ProductId INT NOT NULL,
    MealId INT NOT NULL,
    MealName VARCHAR(255),
    grams DECIMAL(10,2) DEFAULT 100,
    PRIMARY KEY (IntakeLogId, ProductId ,MealId),
    FOREIGN KEY (IntakeLogId) REFERENCES IntakeLog(IntakeLogId) ON DELETE CASCADE,
    FOREIGN KEY (ProductId) REFERENCES Product(ProductId) ON DELETE CASCADE,
    FOREIGN KEY (MealId) REFERENCES Meal(MealId) ON DELETE CASCADE
);

CREATE TABLE Recipe (
    RecipeId INT PRIMARY KEY AUTO_INCREMENT,
    UserId INT NOT NULL,
    Name VARCHAR(255) NOT NULL UNIQUE,
    Description TEXT,
    FOREIGN KEY (UserId) REFERENCES User(UserId) ON DELETE CASCADE
);

CREATE TABLE Meal_has_Recipe (
    MealId INT NOT NULL,
    RecipeId INT NOT NULL,
    PRIMARY KEY (MealId, RecipeId),
    FOREIGN KEY (MealId) REFERENCES Meal(MealId) ON DELETE CASCADE,
    FOREIGN KEY (RecipeId) REFERENCES Recipe(RecipeId) ON DELETE CASCADE
);

CREATE TABLE Recipe_has_Product (
    RecipeId INT NOT NULL,
    ProductId INT NOT NULL,
    Amount FLOAT NOT NULL,
    PRIMARY KEY (RecipeId, ProductId),
    FOREIGN KEY (RecipeId) REFERENCES Recipe(RecipeId) ON DELETE CASCADE,
    FOREIGN KEY (ProductId) REFERENCES Product(ProductId) ON DELETE CASCADE
);

CREATE TABLE Category (
    CategoryId INT PRIMARY KEY AUTO_INCREMENT,
    Name VARCHAR(255) NOT NULL UNIQUE
);

CREATE TABLE Recipe_has_Category (
    RecipeId INT NOT NULL,
    CategoryId INT NOT NULL,
    PRIMARY KEY (RecipeId, CategoryId),
    FOREIGN KEY (RecipeId) REFERENCES Recipe(RecipeId) ON DELETE CASCADE,
    FOREIGN KEY (CategoryId) REFERENCES Category(CategoryId) ON DELETE CASCADE
);

CREATE TABLE Weight_History (
    WeightId INT PRIMARY KEY AUTO_INCREMENT,
    UserId INT NOT NULL,
    WeightDate DATE NOT NULL,
    Weight DECIMAL(10,2),
    FOREIGN KEY (UserId) REFERENCES User(UserId) ON DELETE CASCADE
);